(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6df38a20"],{"268f":function(s,t,e){s.exports=e("fde4")},"32a6":function(s,t,e){var i=e("241e"),a=e("c3a1");e("ce7e")("keys",function(){return function(s){return a(i(s))}})},"454f":function(s,t,e){e("46a7");var i=e("584a").Object;s.exports=function(s,t,e){return i.defineProperty(s,t,e)}},"46a7":function(s,t,e){var i=e("63b6");i(i.S+i.F*!e("8e60"),"Object",{defineProperty:e("d9f6").f})},6762:function(s,t,e){"use strict";var i=e("5ca1"),a=e("c366")(!0);i(i.P,"Array",{includes:function(s){return a(this,s,arguments.length>1?arguments[1]:void 0)}}),e("9c6c")("includes")},"85f2":function(s,t,e){s.exports=e("454f")},"8aae":function(s,t,e){e("32a6"),s.exports=e("584a").Object.keys},a4bb:function(s,t,e){s.exports=e("8aae")},bf90:function(s,t,e){var i=e("36c3"),a=e("bf0b").f;e("ce7e")("getOwnPropertyDescriptor",function(){return function(s,t){return a(i(s),t)}})},ce7e:function(s,t,e){var i=e("63b6"),a=e("584a"),n=e("294c");s.exports=function(s,t){var e=(a.Object||{})[s]||Object[s],o={};o[s]=t(e),i(i.S+i.F*n(function(){e(1)}),"Object",o)}},cebc:function(s,t,e){"use strict";var i=e("268f"),a=e.n(i),n=e("e265"),o=e.n(n),r=e("a4bb"),c=e.n(r),h=e("85f2"),l=e.n(h);function d(s,t,e){return t in s?l()(s,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):s[t]=e,s}function _(s){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{},i=c()(e);"function"===typeof o.a&&(i=i.concat(o()(e).filter(function(s){return a()(e,s).enumerable}))),i.forEach(function(t){d(s,t,e[t])})}return s}e.d(t,"a",function(){return _})},e265:function(s,t,e){s.exports=e("ed33")},e844:function(s,t,e){"use strict";e.r(t);var i=function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("div",{staticClass:"samples"},[e("div",[e("p",[s._v("Start Sample:\n            "),e("el-input",{staticStyle:{width:"300px"},model:{value:s.agent_addr,callback:function(t){s.agent_addr=t},expression:"agent_addr"}}),e("el-button",{staticClass:"ml10",on:{click:s.connect_agent}},[s._v("Connect")])],1)]),e("div",{staticStyle:{"margin-top":"10px"}},[e("el-button",{on:{click:s.list_sessions}},[s._v("Sessions")]),e("el-button",{on:{click:s.list_history}},[s._v("History")]),e("el-button",{on:{click:s.stop_auto_refresh}},[s._v("Stop Refresh")]),e("el-button",{on:{click:s.close_session}},[s._v("Close")]),e("div",{staticStyle:{"margin-top":"10px"}},[e("p",[s._v("History samples:")]),e("ul",{staticClass:"list-content"},s._l(s.history_samples_list,function(t){return e("li",{staticClass:"list-item"},[e("el-link",{attrs:{underline:!1},on:{click:function(e){return s.open_sample(t.path)}}},[s._v("["+s._s(t.type)+"]"+s._s(t.path))])],1)}),0)])],1)])},a=[],n=(e("6762"),e("ac6a"),e("cebc")),o={name:"samples",data:function(){return{agent_addr:"localhost:3333",profiler_addr:"localhost:3344",show_history_samples:!1,show_sessions:!1,history_samples_list:[],sample_sessions_list:[],show_message:!1,dashboard_timer:null,data:{sample_info:{},threads:[],history_samples:[],sample_sessions:[],thread_cpu_time_map:{},session_id:"",type:"",call_tree_data:[{id:1,label:"方法调用",children:[{id:4,label:"二级 1-1"}]}],flame_graph_svg:"",flame_graph_data:""},webSocket:""}},mounted:function(){this.$webSocket.webSocketInit(),this.$ws.onmessage=this.onmessage},computed:{sessionOptions:function(){return this.$store.state.sessionOptions},sessionThreads:function(){return this.$store.state.sessionThreads},sessionCpuTimes:function(){return this.$store.state.sessionCpuTimes},sessionFlameGraph:function(){return this.$store.state.sessionFlameGraph},sampleInfo:function(){return this.$store.state.sampleInfo},sessionSampleInfo:function(){return this.$store.state.sessionSampleInfo},exampleInfo:function(){return this.$store.state.exampleInfo},historySamples:function(){return this.$store.state.historySamples}},created:function(){this.getHistorySamples()},methods:{getHistorySamples:function(){this.historySamples&&(this.history_samples_list=this.historySamples)},webSocketOnOpen:function(){console.log("websocket建立连接")},webSocketOnClose:function(){console.log("websocket销毁连接")},webSocketOnError:function(){console.log("websocket连接失败")},onmessage:function(s){console.log("websocket接收到消息：",s);var t=JSON.parse(s.data),e="success"==t.result;Object.assign(this.data,t.data),this.show_message=!e,e||this.stop_auto_refresh();var i=t.data.session_id;switch(this.$store.commit("example_info",t.data),t.cmd){case"dashboard":var a=t.data.sample_info.sample_data_dir;if(t.data.threads){var o=this.sessionThreads.filter(function(s){if(s.sessionId!=a)return s}),r={sessionId:a,threads:t.data.threads,threadSampleInfo:Object(n["a"])({},t.data.sample_info)};o.push(r),this.$store.commit("session_threads",o)}var c=this.sessionSampleInfo.filter(function(s){if(s.sessionId!=a)return s}),h={sessionId:a,sessionSample:t.data.sample_info};c.push(h),this.$store.commit("session_sample_info",c),this.$store.commit("sample_info",t.data.sample_info);break;case"open_sample":this.start_auto_refresh();break;case"connect_agent":this.start_auto_refresh();break;case"history_samples":console.log("json.data.history_samples",t.data.history_samples),t.data.history_samples&&this.$store.commit("history_samples",t.data.history_samples),this.show_history_samples=!0;break;case"list_sessions":t.data.sample_sessions&&this.$store.commit("session_options",t.data.sample_sessions),this.show_sessions=!0;break;case"cpu_time":var l=[],d=this.sessionCpuTimes.filter(function(s){if(s.sessionId!=i)return s;s.cpuTimeData.forEach(function(s){l.includes(s.id)||l.push(s)})});t.data.thread_cpu_times.forEach(function(s){l.includes(s.id)||l.push(s)});var _={sessionId:i,cpuTimeData:l};d.push(_),this.$store.commit("session_cpu_times",d);break;case"call_tree":break;case"flame_graph":if(t.data.flame_graph_data){var u=[],f=this.sessionFlameGraph.filter(function(s){if(s.sessionId!=i)return s;s.flameGraphList.filter(function(s){s.threadId!=t.data.thread_id&&u.push(s)})});u.push({threadId:t.data.thread_id,flameGraphData:t.data});var p={sessionId:i,flameGraphList:u};f.push(p),this.$store.commit("session_flame_graph",f)}break;default:console.log("unknown message: ",t);break}},connect_agent:function(){this.clear_session();var s={cmd:"connect_agent",options:{agent_addr:this.agent_addr}};this.$webSocket.webSocketSendMessage(JSON.stringify(s)),this.connected=!0},close_session:function(){var s=this;this.connected=!1;var t={cmd:"close_session",options:{session_id:this.sampleInfo.sample_data_dir}};this.$webSocket.webSocketSendMessage(JSON.stringify(t));var e=this.sessionOptions.filter(function(t){if(t.session_id!=s.sampleInfo.sample_data_dir)return t});this.$store.commit("session_options",e)},clear_session:function(){this.stop_auto_refresh(),this.data.session_id="",this.data.threads=[],this.data.sample_info={},this.data.thread_cpu_time_map={}},list_sessions:function(){this.show_sessions=!0,this.show_history_samples=!1,this.$webSocket.webSocketSendMessage(JSON.stringify({cmd:"list_sessions"}))},list_history:function(){this.show_sessions=!1,this.show_history_samples=!0,this.$webSocket.webSocketSendMessage(JSON.stringify({cmd:"history_samples"}))},start_auto_refresh:function(){null==this.dashboard_timer&&(this.do_refresh(),"attach"==this.data.type&&(this.dashboard_timer=setInterval(function(){this.do_refresh()},2e3)))},stop_auto_refresh:function(){null!=this.dashboard_timer&&(clearInterval(this.dashboard_timer),this.dashboard_timer=null)},update_dashboard:function(){console.log("send request: get_dashboard"),this.$webSocket.webSocketSendMessage(JSON.stringify({cmd:"dashboard",options:{session_id:this.data.session_id}}))},update_cpu_time:function(){for(var s=[],t=0;t<this.data.threads.length;t++)s.push(this.data.threads[t].id);var e=900,i=this.data.sample_info.sample_interval,a=this.data.sample_info.record_start_time,n=this.data.sample_info.last_record_time,o=Math.ceil((n-a)/e/i);o>10&&(o=10*Math.floor(o/10));var r=o*i;this.data.sample_info.unit_time_ms=r;var c={cmd:"cpu_time",options:{session_id:this.data.session_id,thread_ids:s,start_time:a,end_time:n,unit_time_ms:r}};this.$webSocket.webSocketSendMessage(JSON.stringify(c))},do_refresh:function(){var s=this;""!=this.data.session_id&&(this.update_dashboard(),setTimeout(function(){s.update_cpu_time()},500))},open_sample:function(s){this.clear_session();var t={cmd:"open_sample",options:{sample_data_dir:s}};this.$webSocket.webSocketSendMessage(JSON.stringify(t)),this.list_sessions()},active_session:function(s,t){this.clear_session(),this.data.session_id=s,this.data.type=t,this.start_auto_refresh()}},watch:{historySamples:function(){this.history_samples_list=this.historySamples}}},r=o,c=e("2877"),h=Object(c["a"])(r,i,a,!1,null,"ba5dd5d0",null);t["default"]=h.exports},ed33:function(s,t,e){e("014b"),s.exports=e("584a").Object.getOwnPropertySymbols},fde4:function(s,t,e){e("bf90");var i=e("584a").Object;s.exports=function(s,t){return i.getOwnPropertyDescriptor(s,t)}}}]);
//# sourceMappingURL=chunk-6df38a20.a7ebdf04.js.map