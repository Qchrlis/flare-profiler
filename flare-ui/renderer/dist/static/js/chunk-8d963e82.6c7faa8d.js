(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-8d963e82"],{6762:function(s,t,e){"use strict";var i=e("5ca1"),a=e("c366")(!0);i(i.P,"Array",{includes:function(s){return a(this,s,arguments.length>1?arguments[1]:void 0)}}),e("9c6c")("includes")},e844:function(s,t,e){"use strict";e.r(t);var i=function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("div",{staticClass:"samples"},[e("div",[e("p",[s._v("Start Sample:\n            "),e("el-input",{staticStyle:{width:"300px"},model:{value:s.agent_addr,callback:function(t){s.agent_addr=t},expression:"agent_addr"}}),e("el-button",{staticClass:"ml10",on:{click:s.connect_agent}},[s._v("Connect")])],1)]),e("div",{staticStyle:{"margin-top":"10px"}},[e("el-button",{on:{click:s.list_sessions}},[s._v("Sessions")]),e("el-button",{on:{click:s.list_history}},[s._v("History")]),e("el-button",{on:{click:s.stop_auto_refresh}},[s._v("Stop Refresh")]),e("el-button",{on:{click:s.close_session}},[s._v("Close")]),e("div",{staticStyle:{"margin-top":"10px"}},[e("p",[s._v("History samples:")]),e("ul",{staticClass:"list-content"},s._l(s.history_samples_list,function(t){return e("li",{staticClass:"list-item"},[e("el-link",{attrs:{underline:!1},on:{click:function(e){return s.open_sample(t.path)}}},[s._v("["+s._s(t.type)+"]"+s._s(t.path))])],1)}),0)])],1)])},a=[],o=(e("6762"),e("ac6a"),{name:"samples",data:function(){return{agent_addr:"localhost:3333",profiler_addr:"localhost:3344",show_history_samples:!1,show_sessions:!1,history_samples_list:[],sample_sessions_list:[],show_message:!1,dashboard_timer:null,data:{sample_info:{},threads:[],history_samples:[],sample_sessions:[],thread_cpu_time_map:{},session_id:"",type:"",call_tree_data:[{id:1,label:"方法调用",children:[{id:4,label:"二级 1-1"}]}],flame_graph_svg:"",flame_graph_data:""},webSocket:""}},mounted:function(){this.$webSocket.webSocketInit(),this.$ws.onmessage=this.onmessage},computed:{sessionOptions:function(){return this.$store.state.sessionOptions},sessionThreads:function(){return this.$store.state.sessionThreads},sessionCpuTimes:function(){return this.$store.state.sessionCpuTimes},sessionFlameGraph:function(){return this.$store.state.sessionFlameGraph},sampleInfo:function(){return this.$store.state.sampleInfo},exampleInfo:function(){return this.$store.state.exampleInfo},historySamples:function(){return this.$store.state.historySamples}},created:function(){this.getHistorySamples()},methods:{getHistorySamples:function(){this.historySamples&&(this.history_samples_list=this.historySamples)},webSocketOnOpen:function(){console.log("websocket建立连接")},webSocketOnClose:function(){console.log("websocket销毁连接")},webSocketOnError:function(){console.log("websocket连接失败")},onmessage:function(s){console.log("websocket接收到消息：",s);var t=JSON.parse(s.data),e="success"==t.result;Object.assign(this.data,t.data),this.show_message=!e,e||this.stop_auto_refresh();var i=t.data.session_id;switch(this.$store.commit("example_info",t.data),t.cmd){case"dashboard":if(t.data.threads){var a=this.sessionThreads.filter(function(s){if(s.sessionId!=t.data.sample_info.sample_data_dir)return s}),o={sessionId:t.data.sample_info.sample_data_dir,threads:t.data.threads};a.push(o),this.$store.commit("session_threads",a)}this.$store.commit("sample_info",t.data.sample_info);break;case"open_sample":this.start_auto_refresh();break;case"connect_agent":this.start_auto_refresh();break;case"history_samples":console.log("json.data.history_samples",t.data.history_samples),t.data.history_samples&&this.$store.commit("history_samples",t.data.history_samples),this.show_history_samples=!0;break;case"list_sessions":t.data.sample_sessions&&this.$store.commit("session_options",t.data.sample_sessions),this.show_sessions=!0;break;case"cpu_time":var n=[],r=this.sessionCpuTimes.filter(function(s){if(s.sessionId!=i)return s;s.cpuTimeData.forEach(function(s){n.includes(s.id)||n.push(s)})});t.data.thread_cpu_times.forEach(function(s){n.includes(s.id)||n.push(s)});var c={sessionId:i,cpuTimeData:n};r.push(c),this.$store.commit("session_cpu_times",r);break;case"call_tree":break;case"flame_graph":if(t.data.flame_graph_data){var h=this.sessionFlameGraph.filter(function(s){if(s.session_id!=i)return s});h.push(t.data),this.$store.commit("session_flame_graph",h)}break;default:console.log("unknown message: ",t);break}},connect_agent:function(){this.clear_session();var s={cmd:"connect_agent",options:{agent_addr:this.agent_addr}};this.$webSocket.webSocketSendMessage(JSON.stringify(s)),this.connected=!0},close_session:function(){var s=this;this.connected=!1;var t={cmd:"close_session",options:{session_id:this.sampleInfo.sample_data_dir}};this.$webSocket.webSocketSendMessage(JSON.stringify(t));var e=this.sessionOptions.filter(function(t){if(t.session_id!=s.sampleInfo.sample_data_dir)return t});this.$store.commit("session_options",e)},clear_session:function(){this.stop_auto_refresh(),this.data.session_id="",this.data.threads=[],this.data.sample_info={},this.data.thread_cpu_time_map={}},list_sessions:function(){this.show_sessions=!0,this.show_history_samples=!1,this.$webSocket.webSocketSendMessage(JSON.stringify({cmd:"list_sessions"}))},list_history:function(){this.show_sessions=!1,this.show_history_samples=!0,this.$webSocket.webSocketSendMessage(JSON.stringify({cmd:"history_samples"}))},start_auto_refresh:function(){null==this.dashboard_timer&&(this.do_refresh(),"attach"==this.data.type&&(this.dashboard_timer=setInterval(function(){this.do_refresh()},2e3)))},stop_auto_refresh:function(){null!=this.dashboard_timer&&(clearInterval(this.dashboard_timer),this.dashboard_timer=null)},update_dashboard:function(){console.log("send request: get_dashboard"),this.$webSocket.webSocketSendMessage(JSON.stringify({cmd:"dashboard",options:{session_id:this.data.session_id}}))},update_cpu_time:function(){for(var s=[],t=0;t<this.data.threads.length;t++)s.push(this.data.threads[t].id);var e=900,i=this.data.sample_info.sample_interval,a=this.data.sample_info.record_start_time,o=this.data.sample_info.last_record_time,n=Math.ceil((o-a)/e/i);n>10&&(n=10*Math.floor(n/10));var r=n*i;this.data.sample_info.unit_time_ms=r;var c={cmd:"cpu_time",options:{session_id:this.data.session_id,thread_ids:s,start_time:a,end_time:o,unit_time_ms:r}};this.$webSocket.webSocketSendMessage(JSON.stringify(c))},do_refresh:function(){var s=this;""!=this.data.session_id&&(this.update_dashboard(),setTimeout(function(){s.update_cpu_time()},500))},open_sample:function(s){this.clear_session();var t={cmd:"open_sample",options:{sample_data_dir:s}};this.$webSocket.webSocketSendMessage(JSON.stringify(t)),this.list_sessions()},active_session:function(s,t){this.clear_session(),this.data.session_id=s,this.data.type=t,this.start_auto_refresh()}},watch:{historySamples:function(){this.history_samples_list=this.historySamples}}}),n=o,r=e("2877"),c=Object(r["a"])(n,i,a,!1,null,"e96c9f2e",null);t["default"]=c.exports}}]);
//# sourceMappingURL=chunk-8d963e82.6c7faa8d.js.map