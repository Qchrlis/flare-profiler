(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5f485733"],{"1af6":function(t,s,e){var i=e("63b6");i(i.S,"Array",{isArray:e("9003")})},"20fd":function(t,s,e){"use strict";var i=e("d9f6"),a=e("aebd");t.exports=function(t,s,e){s in t?i.f(t,s,a(0,e)):t[s]=e}},"2fdb":function(t,s,e){"use strict";var i=e("5ca1"),a=e("d2c8"),n="includes";i(i.P+i.F*e("5147")(n),"String",{includes:function(t){return!!~a(this,t,n).indexOf(t,arguments.length>1?arguments[1]:void 0)}})},3702:function(t,s,e){var i=e("481b"),a=e("5168")("iterator"),n=Array.prototype;t.exports=function(t){return void 0!==t&&(i.Array===t||n[a]===t)}},"40c3":function(t,s,e){var i=e("6b4c"),a=e("5168")("toStringTag"),n="Arguments"==i(function(){return arguments}()),o=function(t,s){try{return t[s]}catch(e){}};t.exports=function(t){var s,e,r;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(e=o(s=Object(t),a))?e:n?i(s):"Object"==(r=i(s))&&"function"==typeof s.callee?"Arguments":r}},"4ee1":function(t,s,e){var i=e("5168")("iterator"),a=!1;try{var n=[7][i]();n["return"]=function(){a=!0},Array.from(n,function(){throw 2})}catch(o){}t.exports=function(t,s){if(!s&&!a)return!1;var e=!1;try{var n=[7],r=n[i]();r.next=function(){return{done:e=!0}},n[i]=function(){return r},t(n)}catch(o){}return e}},5147:function(t,s,e){var i=e("2b4c")("match");t.exports=function(t){var s=/./;try{"/./"[t](s)}catch(e){try{return s[i]=!1,!"/./"[t](s)}catch(a){}}return!0}},"549b":function(t,s,e){"use strict";var i=e("d864"),a=e("63b6"),n=e("241e"),o=e("b0dc"),r=e("3702"),c=e("b447"),l=e("20fd"),d=e("7cd6");a(a.S+a.F*!e("4ee1")(function(t){Array.from(t)}),"Array",{from:function(t){var s,e,a,h,u=n(t),_="function"==typeof this?this:Array,f=arguments.length,p=f>1?arguments[1]:void 0,m=void 0!==p,b=0,v=d(u);if(m&&(p=i(p,f>2?arguments[2]:void 0,2)),void 0==v||_==Array&&r(v))for(s=c(u.length),e=new _(s);s>b;b++)l(e,b,m?p(u[b],b):u[b]);else for(h=v.call(u),e=new _;!(a=h.next()).done;b++)l(e,b,m?o(h,p,[a.value,b],!0):a.value);return e.length=b,e}})},"54a1":function(t,s,e){e("6c1c"),e("1654"),t.exports=e("95d5")},6762:function(t,s,e){"use strict";var i=e("5ca1"),a=e("c366")(!0);i(i.P,"Array",{includes:function(t){return a(this,t,arguments.length>1?arguments[1]:void 0)}}),e("9c6c")("includes")},"774e":function(t,s,e){t.exports=e("d2d5")},"7cd6":function(t,s,e){var i=e("40c3"),a=e("5168")("iterator"),n=e("481b");t.exports=e("584a").getIteratorMethod=function(t){if(void 0!=t)return t[a]||t["@@iterator"]||n[i(t)]}},"95d5":function(t,s,e){var i=e("40c3"),a=e("5168")("iterator"),n=e("481b");t.exports=e("584a").isIterable=function(t){var s=Object(t);return void 0!==s[a]||"@@iterator"in s||n.hasOwnProperty(i(s))}},a745:function(t,s,e){t.exports=e("f410")},aae3:function(t,s,e){var i=e("d3f4"),a=e("2d95"),n=e("2b4c")("match");t.exports=function(t){var s;return i(t)&&(void 0!==(s=t[n])?!!s:"RegExp"==a(t))}},b0dc:function(t,s,e){var i=e("e4ae");t.exports=function(t,s,e,a){try{return a?s(i(e)[0],e[1]):s(e)}catch(o){var n=t["return"];throw void 0!==n&&i(n.call(t)),o}}},c8bb:function(t,s,e){t.exports=e("54a1")},d2c8:function(t,s,e){var i=e("aae3"),a=e("be13");t.exports=function(t,s,e){if(i(s))throw TypeError("String#"+e+" doesn't accept regex!");return String(a(t))}},d2d5:function(t,s,e){e("1654"),e("549b"),t.exports=e("584a").Array.from},e844:function(t,s,e){"use strict";e.r(s);var i=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"samples"},[e("div",[e("p",[t._v("Start Sample:\n            "),e("el-input",{staticStyle:{width:"300px"},model:{value:t.agent_addr,callback:function(s){t.agent_addr=s},expression:"agent_addr"}}),e("el-button",{staticClass:"ml10",on:{click:t.connect_agent}},[t._v("Connect")])],1)]),e("div",{staticStyle:{"margin-top":"10px"}},[e("el-button",{on:{click:t.list_sessions}},[t._v("Sessions")]),e("el-button",{on:{click:t.list_history}},[t._v("History")]),e("el-button",{on:{click:t.stop_auto_refresh}},[t._v("Stop Refresh")]),e("el-button",{on:{click:t.close_session}},[t._v("Close")]),e("div",{staticStyle:{"margin-top":"10px"}},[e("p",[t._v("History samples:")]),e("ul",{staticClass:"list-content"},t._l(t.history_samples_list,function(s){return e("li",{staticClass:"list-item"},[e("el-link",{attrs:{underline:!1},on:{click:function(e){return t.open_sample(s.path)}}},[t._v("["+t._s(s.type)+"]"+t._s(s.path))])],1)}),0)])],1)])},a=[],n=(e("6762"),e("2fdb"),e("ac6a"),e("a745")),o=e.n(n);function r(t){if(o()(t)){for(var s=0,e=new Array(t.length);s<t.length;s++)e[s]=t[s];return e}}var c=e("774e"),l=e.n(c),d=e("c8bb"),h=e.n(d);function u(t){if(h()(Object(t))||"[object Arguments]"===Object.prototype.toString.call(t))return l()(t)}function _(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function f(t){return r(t)||u(t)||_()}var p={name:"samples",data:function(){return{agent_addr:"localhost:3333",profiler_addr:"localhost:3344",show_history_samples:!1,show_sessions:!1,history_samples_list:[],sample_sessions_list:[],show_message:!1,dashboard_timer:null,data:{sample_info:{},threads:[],history_samples:[],sample_sessions:[],thread_cpu_time_map:{},session_id:"",type:"",call_tree_data:[{id:1,label:"方法调用",children:[{id:4,label:"二级 1-1"}]}],flame_graph_svg:"",flame_graph_data:""},webSocket:""}},mounted:function(){this.$webSocket.webSocketInit(),this.$ws.onmessage=this.onmessage},computed:{sessionOptions:function(){return this.$store.state.sessionOptions},sessionThreads:function(){return this.$store.state.sessionThreads},sessionCpuTimes:function(){return this.$store.state.sessionCpuTimes},sessionFlameGraph:function(){return this.$store.state.sessionFlameGraph},sampleInfo:function(){return this.$store.state.sampleInfo},exampleInfo:function(){return this.$store.state.exampleInfo},historySamples:function(){return this.$store.state.historySamples}},created:function(){this.getHistorySamples()},methods:{getHistorySamples:function(){this.historySamples&&(this.history_samples_list=this.historySamples)},webSocketOnOpen:function(){console.log("websocket建立连接")},webSocketOnClose:function(){console.log("websocket销毁连接")},webSocketOnError:function(){console.log("websocket连接失败")},onmessage:function(t){console.log("websocket接收到消息：",t);var s=JSON.parse(t.data),e="success"==s.result;Object.assign(this.data,s.data),this.show_message=!e,e||this.stop_auto_refresh();var i=s.data.session_id;switch(this.$store.commit("example_info",s.data),s.cmd){case"dashboard":if(s.data.threads){var a=this.sessionThreads;a.set(s.data.sample_info.sample_data_dir,s.data.threads),this.$store.commit("session_threads",a)}this.$store.commit("sample_info",s.data.sample_info);break;case"open_sample":this.start_auto_refresh();break;case"connect_agent":this.start_auto_refresh();break;case"history_samples":console.log("json.data.history_samples",s.data.history_samples),s.data.history_samples&&this.$store.commit("history_samples",s.data.history_samples),this.show_history_samples=!0;break;case"list_sessions":s.data.sample_sessions&&this.$store.commit("session_options",s.data.sample_sessions),this.show_sessions=!0;break;case"cpu_time":var n=this.sessionCpuTimes,o=[];if(n.has(i)){var r=n.get(i);o=f(r),s.data.thread_cpu_times.forEach(function(t){console.log("!cpuTimeList.includes(item1.id)",!o.includes(t.id)),o.includes(t.id)||o.push(t),console.log("cpuTimeList",o)})}else s.data.thread_cpu_times.forEach(function(t){o.push(t)});n.set(i,o),this.$store.commit("session_cpu_times",n);break;case"call_tree":break;case"flame_graph":if(console.log("接收到flame_graph消息，内容："),s.data.flame_graph_data){var c=this.sessionFlameGraph;c.set(i,s.data),this.$store.commit("session_flame_graph",c)}break;default:console.log("unknown message: ",s);break}},connect_agent:function(){this.clear_session();var t={cmd:"connect_agent",options:{agent_addr:this.agent_addr}};this.$webSocket.webSocketSendMessage(JSON.stringify(t)),this.connected=!0},close_session:function(){var t=this;this.connected=!1;var s={cmd:"close_session",options:{session_id:this.sampleInfo.sample_data_dir}};this.$webSocket.webSocketSendMessage(JSON.stringify(s));var e=this.sessionOptions.filter(function(s){if(s.session_id!=t.sampleInfo.sample_data_dir)return s});this.$store.commit("session_options",e)},clear_session:function(){this.stop_auto_refresh(),this.data.session_id="",this.data.threads=[],this.data.sample_info={},this.data.thread_cpu_time_map={}},list_sessions:function(){this.show_sessions=!0,this.show_history_samples=!1,this.$webSocket.webSocketSendMessage(JSON.stringify({cmd:"list_sessions"}))},list_history:function(){this.show_sessions=!1,this.show_history_samples=!0,this.$webSocket.webSocketSendMessage(JSON.stringify({cmd:"history_samples"}))},start_auto_refresh:function(){null==this.dashboard_timer&&(this.do_refresh(),"attach"==this.data.type&&(this.dashboard_timer=setInterval(function(){this.do_refresh()},2e3)))},stop_auto_refresh:function(){null!=this.dashboard_timer&&(clearInterval(this.dashboard_timer),this.dashboard_timer=null)},update_dashboard:function(){console.log("send request: get_dashboard"),this.$webSocket.webSocketSendMessage(JSON.stringify({cmd:"dashboard",options:{session_id:this.data.session_id}}))},update_cpu_time:function(){for(var t=[],s=0;s<this.data.threads.length;s++)t.push(this.data.threads[s].id);var e=900,i=this.data.sample_info.sample_interval,a=this.data.sample_info.record_start_time,n=this.data.sample_info.last_record_time,o=Math.ceil((n-a)/e/i);o>10&&(o=10*Math.floor(o/10));var r=o*i;this.data.sample_info.unit_time_ms=r;var c={cmd:"cpu_time",options:{session_id:this.data.session_id,thread_ids:t,start_time:a,end_time:n,unit_time_ms:r}};this.$webSocket.webSocketSendMessage(JSON.stringify(c))},do_refresh:function(){var t=this;""!=this.data.session_id&&(this.update_dashboard(),setTimeout(function(){t.update_cpu_time()},500))},open_sample:function(t){this.clear_session();var s={cmd:"open_sample",options:{sample_data_dir:t}};this.$webSocket.webSocketSendMessage(JSON.stringify(s)),this.list_sessions()},active_session:function(t,s){this.clear_session(),this.data.session_id=t,this.data.type=s,this.start_auto_refresh()}},watch:{historySamples:function(){this.history_samples_list=this.historySamples}}},m=p,b=e("2877"),v=Object(b["a"])(m,i,a,!1,null,"03e0d49e",null);s["default"]=v.exports},f410:function(t,s,e){e("1af6"),t.exports=e("584a").Array.isArray}}]);
//# sourceMappingURL=chunk-5f485733.aa9bdeb2.js.map