(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5f485733"],{"1af6":function(t,s,e){var a=e("63b6");a(a.S,"Array",{isArray:e("9003")})},"20fd":function(t,s,e){"use strict";var a=e("d9f6"),i=e("aebd");t.exports=function(t,s,e){s in t?a.f(t,s,i(0,e)):t[s]=e}},"2fdb":function(t,s,e){"use strict";var a=e("5ca1"),i=e("d2c8"),o="includes";a(a.P+a.F*e("5147")(o),"String",{includes:function(t){return!!~i(this,t,o).indexOf(t,arguments.length>1?arguments[1]:void 0)}})},3702:function(t,s,e){var a=e("481b"),i=e("5168")("iterator"),o=Array.prototype;t.exports=function(t){return void 0!==t&&(a.Array===t||o[i]===t)}},"40c3":function(t,s,e){var a=e("6b4c"),i=e("5168")("toStringTag"),o="Arguments"==a(function(){return arguments}()),n=function(t,s){try{return t[s]}catch(e){}};t.exports=function(t){var s,e,r;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(e=n(s=Object(t),i))?e:o?a(s):"Object"==(r=a(s))&&"function"==typeof s.callee?"Arguments":r}},"4ee1":function(t,s,e){var a=e("5168")("iterator"),i=!1;try{var o=[7][a]();o["return"]=function(){i=!0},Array.from(o,function(){throw 2})}catch(n){}t.exports=function(t,s){if(!s&&!i)return!1;var e=!1;try{var o=[7],r=o[a]();r.next=function(){return{done:e=!0}},o[a]=function(){return r},t(o)}catch(n){}return e}},5147:function(t,s,e){var a=e("2b4c")("match");t.exports=function(t){var s=/./;try{"/./"[t](s)}catch(e){try{return s[a]=!1,!"/./"[t](s)}catch(i){}}return!0}},"549b":function(t,s,e){"use strict";var a=e("d864"),i=e("63b6"),o=e("241e"),n=e("b0dc"),r=e("3702"),c=e("b447"),d=e("20fd"),_=e("7cd6");i(i.S+i.F*!e("4ee1")(function(t){Array.from(t)}),"Array",{from:function(t){var s,e,i,l,h=o(t),u="function"==typeof this?this:Array,p=arguments.length,f=p>1?arguments[1]:void 0,m=void 0!==f,v=0,b=_(h);if(m&&(f=a(f,p>2?arguments[2]:void 0,2)),void 0==b||u==Array&&r(b))for(s=c(h.length),e=new u(s);s>v;v++)d(e,v,m?f(h[v],v):h[v]);else for(l=b.call(h),e=new u;!(i=l.next()).done;v++)d(e,v,m?n(l,f,[i.value,v],!0):i.value);return e.length=v,e}})},"54a1":function(t,s,e){e("6c1c"),e("1654"),t.exports=e("95d5")},6762:function(t,s,e){"use strict";var a=e("5ca1"),i=e("c366")(!0);a(a.P,"Array",{includes:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}}),e("9c6c")("includes")},"774e":function(t,s,e){t.exports=e("d2d5")},"7cd6":function(t,s,e){var a=e("40c3"),i=e("5168")("iterator"),o=e("481b");t.exports=e("584a").getIteratorMethod=function(t){if(void 0!=t)return t[i]||t["@@iterator"]||o[a(t)]}},"95d5":function(t,s,e){var a=e("40c3"),i=e("5168")("iterator"),o=e("481b");t.exports=e("584a").isIterable=function(t){var s=Object(t);return void 0!==s[i]||"@@iterator"in s||o.hasOwnProperty(a(s))}},a745:function(t,s,e){t.exports=e("f410")},aae3:function(t,s,e){var a=e("d3f4"),i=e("2d95"),o=e("2b4c")("match");t.exports=function(t){var s;return a(t)&&(void 0!==(s=t[o])?!!s:"RegExp"==i(t))}},b0dc:function(t,s,e){var a=e("e4ae");t.exports=function(t,s,e,i){try{return i?s(a(e)[0],e[1]):s(e)}catch(n){var o=t["return"];throw void 0!==o&&a(o.call(t)),n}}},c8bb:function(t,s,e){t.exports=e("54a1")},d2c8:function(t,s,e){var a=e("aae3"),i=e("be13");t.exports=function(t,s,e){if(a(s))throw TypeError("String#"+e+" doesn't accept regex!");return String(i(t))}},d2d5:function(t,s,e){e("1654"),e("549b"),t.exports=e("584a").Array.from},e844:function(t,s,e){"use strict";e.r(s);var a=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"samples"},[e("div",[e("p",[t._v("Start Sample:\n            "),e("el-input",{staticStyle:{width:"300px"},model:{value:t.agent_addr,callback:function(s){t.agent_addr=s},expression:"agent_addr"}}),e("el-button",{staticClass:"ml10",on:{click:t.connect_agent}},[t._v("Connect")])],1)]),e("div",{staticStyle:{"margin-top":"10px"}},[e("el-button",{on:{click:t.list_sessions}},[t._v("Sessions")]),e("el-button",{on:{click:t.list_history}},[t._v("History")]),e("el-button",{on:{click:t.stop_auto_refresh}},[t._v("Stop Refresh")]),e("el-button",{on:{click:t.close_session}},[t._v("Close")]),e("div",{directives:[{name:"show",rawName:"v-show",value:t.show_history_samples,expression:"show_history_samples"}]},[e("p",[t._v("History samples:")]),e("ul",{staticClass:"list-content"},t._l(t.data.history_samples,function(s){return e("li",{staticClass:"list-item",on:{click:function(e){return t.open_sample(s.path)}}},[t._v("["+t._s(s.type)+"]"+t._s(s.path)+"\n                ")])}),0)]),e("div",{directives:[{name:"show",rawName:"v-show",value:t.show_sessions,expression:"show_sessions"}],staticClass:"list-div"},[e("p",[t._v("Sample sessions:")]),e("ul",{staticClass:"list-content"},t._l(t.data.sample_sessions,function(s){return e("li",{staticClass:"list-item",on:{click:function(e){return t.active_session(s.session_id,s.type)}}},[t._v("\n                    ["+t._s(s.type)+"]"+t._s(s.session_id)+"\n                ")])}),0)])],1),e("div",{directives:[{name:"show",rawName:"v-show",value:t.show_message,expression:"show_message"}],staticClass:"message"},[e("p",[t._v("错误信息："+t._s(t.data.message))])]),e("div",{staticStyle:{"margin-top":"10px"}},[e("p",[t._v("Sample Session: "+t._s(t.data.session_id)+" ("+t._s(t.data.type)+")")]),e("p",[t._v("Sample Start Time: "+t._s(t.data.sample_info.sample_start_time))]),e("p",[t._v("Record Start Time: "+t._s(t.data.sample_info.record_start_time))]),e("p",[t._v("Last Record Time: "+t._s(t.data.sample_info.last_record_time))]),e("p",[t._v("Record Duration: "+t._s((t.data.sample_info.last_record_time-t.data.sample_info.record_start_time)/1e3)+"s")])])])},i=[],o=(e("6762"),e("2fdb"),e("ac6a"),e("a745")),n=e.n(o);function r(t){if(n()(t)){for(var s=0,e=new Array(t.length);s<t.length;s++)e[s]=t[s];return e}}var c=e("774e"),d=e.n(c),_=e("c8bb"),l=e.n(_);function h(t){if(l()(Object(t))||"[object Arguments]"===Object.prototype.toString.call(t))return d()(t)}function u(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function p(t){return r(t)||h(t)||u()}var f={name:"samples",data:function(){return{agent_addr:"localhost:3333",profiler_addr:"localhost:3344",show_history_samples:!1,show_sessions:!1,history_samples_list:[],sample_sessions_list:[],show_message:!1,dashboard_timer:null,data:{sample_info:{},threads:[],history_samples:[],sample_sessions:[],thread_cpu_time_map:{},session_id:"",type:"",call_tree_data:[{id:1,label:"方法调用",children:[{id:4,label:"二级 1-1"}]}],flame_graph_svg:"",flame_graph_data:""},webSocket:""}},mounted:function(){this.$webSocket.webSocketInit(),this.$ws.onmessage=this.onmessage},computed:{sessionOptions:function(){return this.$store.state.sessionOptions},sessionThreads:function(){return this.$store.state.sessionThreads},sessionCpuTimes:function(){return this.$store.state.sessionCpuTimes}},created:function(){},methods:{webSocketOnOpen:function(){console.log("websocket建立连接")},webSocketOnClose:function(){console.log("websocket销毁连接")},webSocketOnError:function(){console.log("websocket连接失败")},onmessage:function(t){console.log("websocket接收到消息：",t);var s=JSON.parse(t.data),e="success"==s.result;switch(Object.assign(this.data,s.data),this.show_message=!e,e||this.stop_auto_refresh(),this.$store.commit("example_info",s.data),s.cmd){case"dashboard":if(s.data.threads){var a=this.sessionThreads;a.set(s.data.sample_info.sample_data_dir,s.data.threads),this.$store.commit("session_threads",a)}this.$store.commit("sample_info",s.data.sample_info);break;case"open_sample":this.start_auto_refresh();break;case"connect_agent":this.start_auto_refresh();break;case"history_samples":this.show_history_samples=!0;break;case"list_sessions":this.$store.commit("session_options",s.data.sample_sessions),this.show_sessions=!0;break;case"cpu_time":var i=s.data.session_id,o=this.sessionCpuTimes,n=[];if(o.has(i)){var r=o.get(i);n=p(r),s.data.thread_cpu_times.forEach(function(t){console.log("!cpuTimeList.includes(item1.id)",!n.includes(t.id)),n.includes(t.id)||n.push(t),console.log("cpuTimeList",n)})}else s.data.thread_cpu_times.forEach(function(t){n.push(t)});o.set(i,n),this.$store.commit("session_cpu_times",o),this.on_cpu_time_result(s.data);break;case"call_tree":break;case"flame_graph":console.log("接收到flame_graph消息，内容：",s.data),s.data.flame_graph_data&&(this.$store.commit("session_flame_graph",s.data),console.log("json.data.flame_graph_data",s.data.flame_graph_data));break;default:console.log("unknown message: ",s);break}},connect_agent:function(){this.clear_session();var t={cmd:"connect_agent",options:{agent_addr:this.agent_addr}};this.$webSocket.webSocketSendMessage(JSON.stringify(t)),this.connected=!0},close_session:function(){this.connected=!1;var t={cmd:"close_session",options:{session_id:this.data.session_id}};this.$webSocket.webSocketSendMessage(JSON.stringify(t))},clear_session:function(){this.stop_auto_refresh(),this.data.session_id="",this.data.threads=[],this.data.sample_info={},this.data.thread_cpu_time_map={}},list_sessions:function(){this.show_sessions=!0,this.show_history_samples=!1,this.$webSocket.webSocketSendMessage(JSON.stringify({cmd:"list_sessions"}))},list_history:function(){this.show_sessions=!1,this.show_history_samples=!0,this.$webSocket.webSocketSendMessage(JSON.stringify({cmd:"history_samples"}))},start_auto_refresh:function(){null==this.dashboard_timer&&(this.do_refresh(),"attach"==this.data.type&&(this.dashboard_timer=setInterval(function(){this.do_refresh()},2e3)))},stop_auto_refresh:function(){null!=this.dashboard_timer&&(clearInterval(this.dashboard_timer),this.dashboard_timer=null)},update_dashboard:function(){console.log("send request: get_dashboard"),this.$webSocket.webSocketSendMessage(JSON.stringify({cmd:"dashboard",options:{session_id:this.data.session_id}}))},update_cpu_time:function(){for(var t=[],s=0;s<this.data.threads.length;s++)t.push(this.data.threads[s].id);var e=900,a=this.data.sample_info.sample_interval,i=this.data.sample_info.record_start_time,o=this.data.sample_info.last_record_time,n=Math.ceil((o-i)/e/a);n>10&&(n=10*Math.floor(n/10));var r=n*a;this.data.sample_info.unit_time_ms=r;var c={cmd:"cpu_time",options:{session_id:this.data.session_id,thread_ids:t,start_time:i,end_time:o,unit_time_ms:r}};this.$webSocket.webSocketSendMessage(JSON.stringify(c))},do_refresh:function(){var t=this;""!=this.data.session_id&&(this.update_dashboard(),setTimeout(function(){t.update_cpu_time()},500))},open_sample:function(t){this.clear_session();var s={cmd:"open_sample",options:{sample_data_dir:t}};this.$webSocket.webSocketSendMessage(JSON.stringify(s))},on_cpu_time_result:function(t){console.log("data",t),console.log("data.thread_cpu_times",t.thread_cpu_times);this.data.sample_info.record_start_time,this.data.sample_info.last_record_time,this.data.sample_info.unit_time_ms;for(var s=0;s<t.thread_cpu_times.length;s++){var e=t.thread_cpu_times[s];e.total_cpu_time}},active_session:function(t,s){this.clear_session(),this.data.session_id=t,this.data.type=s,this.start_auto_refresh()}}},m=f,v=e("2877"),b=Object(v["a"])(m,a,i,!1,null,"d0d7c94e",null);s["default"]=b.exports},f410:function(t,s,e){e("1af6"),t.exports=e("584a").Array.isArray}}]);
//# sourceMappingURL=chunk-5f485733.2728d04e.js.map